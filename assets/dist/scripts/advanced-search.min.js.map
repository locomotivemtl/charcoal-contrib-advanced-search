{"version":3,"file":"scripts/advanced-search.min.js","names":["AdvancedSearchFilterRecap","constructor","$form","$activeFilterList","parent","this","filterObject","refresh","buildFilterObjectFromInputs","displayFilters","output","that","formFieldIds","$","each","i","current","value","type","is","extractLabelAndValueFromInput","includes","id","push","domElement","tmp","$domElement","formField","attr","filterVal","val","filterType","filterWrapper","closest","filterName","first","text","inputName","endsWith","replace","extractFromDateRange","tagName","extractFromSelect","extractFromCheckbox","name","primaryName","filter","element","join","Array","from","selectedOptions","map","option","innerHTML","empty","currentFilter","addActiveFilter","opts","label","listItem","append","addClass","removeActiveFilter","filter_recap","removeListItem","length","clearFilter","remove","widgetL10n","window","jQuery","AdvancedSearch","Charcoal","Admin","Widget","data","properties_options","super","call","init","$applyBtn","$exportBtn","$sortBtn","totalRows","isReloading","clearOnEmpty","filterRecap","on","e","preventDefault","stopPropagation","submit","bind","target","countChanges","clear","sort","tab_key","removeClass","click","widget","export","onFieldChange","trigger","countActiveFilters","manager","ready","widgets","components","forEach","set_filters","total_rows","setTotalRows","targetFilter","date","filterInput","filterInputName","find","cleanFilterId","filterId","filterIdClean","get","totalRowsEl","changeCount","hasChanges","changeCountString","prop","tabChangeCount","tabFilterCountEl","index","item","selectpicker","datetimepicker","listItemType","optionEl","hasClass","property","direction","filterObj","input","dataOperator","operator","parseInvalidBetween","checked","matching","matching_value","fields","request","filters","serializeArray","field","prepare_request","dispatch","widget_type","widget_options","with_data","orders","collection_config","url","admin_url","location","search","success","failure","complete","reloadXHR","ajax","JSON","stringify","dataType","contentType","response","widget_id","feedbacks","level","message","loadingFailed","wid","set_id","add_opts","file","href","feedback","suppress_feedback","resolveSimpleJsonXhr","p_filters","orderProperty","collection_table","filter_obj","propName","filter_table","value_override","table","conjunction","mode","pagination","page","condition","set_orders","site_search","search_widget","get_widget","set_search_query","$input","search_query","set_filter","search_filters","reload","widget_data","Widget_Advanced_Search","Widget_Advanced_Search_Tabs"],"sources":["../../src/scripts/filter-recap.js","../../src/scripts/advanced-search.js","../../src/scripts/index.js"],"sourcesContent":["class AdvancedSearchFilterRecap {\n    constructor($form, $activeFilterList, parent) {\n        this.$form = $form;\n        this.$activeFilterList = $activeFilterList;\n        this.filterObject = undefined;\n        this.parent = parent;\n    }\n\n    /**\n     * Event\n     * Call when anything changes in the filter area\n     */\n    refresh() {\n        this.buildFilterObjectFromInputs();\n        this.displayFilters();\n    }\n\n    /**\n     * Fetch all inputs and build a json usable to display filters\n     *\n     * @param $container\n     */\n    buildFilterObjectFromInputs() {\n        const output = [];\n        const that = this;\n        const formFieldIds = [];\n\n        $('input, select', this.$form).each(function (i, current) {\n            // Skip unfilled filters\n            // @todo Add more context than only !current.value\n            if (!current.value) {\n                return true;\n            }\n\n            if (current.type === 'checkbox' && !$(current).is(':checked')) {\n                return true;\n            }\n\n            const value = that.extractLabelAndValueFromInput(current);\n\n            if (!value) {\n                return;\n            }\n\n            if (!formFieldIds.includes(value.id)) {\n                formFieldIds.push(value.id);\n                // Populate output\n                output.push(value);\n            }\n        });\n\n        this.filterObject = output;\n    }\n\n    extractLabelAndValueFromInput(domElement) {\n        let tmp = null;\n\n        // Base values\n        const $domElement = $(domElement);\n        let formField = $domElement.attr('id');\n        let filterVal = $domElement.val();\n        let filterType = 'input';\n\n        // Filter name from label\n        const filterWrapper = $domElement.closest('fieldset');\n        const filterName = $('label', filterWrapper).first().text();\n\n        const inputName = $domElement.attr('name');\n\n        if (typeof inputName === 'undefined') {\n            return false;\n        }\n\n        // Datetime range\n        if (inputName.endsWith(\"[to]\") || inputName.endsWith(\"[from]\")) {\n            // The formField id will be used to prevent having twice the safe filter displayed in the list\n            // Since the from and to inputs have the same ID except for that prefix\n            formField = formField.replace('from_', '').replace('to_', '');\n            tmp = this.extractFromDateRange(domElement);\n        }\n\n        // Select\n        if (domElement.tagName === 'SELECT') {\n            tmp = this.extractFromSelect(domElement);\n        }\n\n        // Checkbox\n        if (domElement.type === 'checkbox') {\n            tmp = this.extractFromCheckbox(domElement);\n        }\n\n        // Override values\n        if (tmp !== null && tmp) {\n            filterType = tmp.type;\n            filterVal = tmp.val;\n        }\n\n        return {\n            id: formField,\n            type: filterType,\n            val: filterVal,\n            name: filterName\n        };\n    }\n\n    /**\n     *\n     * @param $input\n     * @returns {{val: string, type: string}}\n     */\n    extractFromDateRange(domElement) {\n        const filterInput = $(domElement);\n        const filterInputName = filterInput.attr('name');\n\n        // Is a date range\n        const filterType = 'date-range';\n        const primaryName = filterInputName.replace('[from]', '').replace('[to]', '');\n        const dates = [\n            $('input[name=\"' + primaryName + '[from]\"]').val() || null,\n            $('input[name=\"' + primaryName + '[to]\"]').val() || null\n        ].filter(function (element) {\n            return element !== null;\n        });\n\n        const filterVal = dates.join(' - ');\n\n        return {\n            type: filterType,\n            val: filterVal\n        };\n    }\n\n    extractFromSelect(domElement) {\n        const filterType = 'select';\n        const filterVal = Array.from(domElement.selectedOptions).map(function (option) {\n            return option.value ? option.innerHTML : null;\n        })\n            .filter(function (element) {\n                return element !== null;\n            })\n            .join(', ');\n\n        return {\n            type: filterType,\n            val: filterVal\n        };\n    }\n\n    /**\n     * Weird, it should definitly be Yes at all time at this point\n     *\n     * @param domElement\n     * @returns {{val: (string), type: string}}\n     */\n    extractFromCheckbox(domElement) {\n        const filterVal = $(domElement).is(':checked') ? ($('html').attr('lang') === 'fr' ? 'Oui' : 'Yes') : '';\n\n        return {\n            type: 'checkbox',\n            val: filterVal\n        };\n    }\n\n    /**\n     * Display filters labels from the json\n     */\n    displayFilters() {\n        if (this.filterObject === undefined) {\n            return;\n        }\n        this.$activeFilterList.empty();\n\n        for (const i in this.filterObject) {\n            const currentFilter = this.filterObject[i];\n            this.addActiveFilter(currentFilter);\n        }\n    }\n\n    /**\n     * Add Active Filter.\n     *\n     * @param {object} opts\n     * @param {string} opts.id\n     * @param {string} opts.type\n     * @param {string} opts.label\n     * @param {string} opts.val\n     */\n    addActiveFilter(opts) {\n        const id = opts.id;\n        const type = opts.type;\n        const label = opts.name;\n        const value = opts.val;\n\n        const listItem = $('<li></li>')\n            .append($('<span></span>').addClass('label').text(label).attr('title', label))\n            .append($('<span></span>').addClass('value').text(value).attr('title', value))\n            .append($('<div></div>').addClass('remove fa fa-times js-remove-filter'))\n            .attr('data-key', id)\n            .attr('data-type', type);\n        $(this.$activeFilterList).append(listItem);\n    }\n\n    /**\n     * Remove item from active filter list.\n     *\n     * @param {Element|string} domElement Remove Event or target string.\n     */\n    removeActiveFilter(domElement) {\n        var filter_recap = this;\n\n        // Remove all filters if domElement is undefined.\n        if (typeof domElement === 'undefined') {\n            $('li', filter_recap.$activeFilterList).each(function() {\n                filter_recap.removeListItem(this);\n            });\n            return;\n        }\n\n        // Remove domElement from the active filter list.\n        filter_recap.removeListItem(domElement);\n    }\n\n    removeListItem(domElement) {\n        // Remove domElement from the active filter list.\n        const listItem = $(domElement).closest('li');\n\n        if (listItem.length) {\n            this.parent.clearFilter(listItem);\n            listItem.remove();\n        }\n    }\n}\n\nexport default AdvancedSearchFilterRecap;\n","/* global Charcoal */\nimport AdvancedSearchFilterRecap from \"./filter-recap\";\n\nconst widgetL10n = window.widgetL10n || {};\nconst $ = jQuery;\n\n/**\n * Advanced search widget used for filtering a list\n * `charcoal/advanced-search/widget/advanced-search`\n *\n * Require:\n * - jQuery\n *\n * @param  {Object}  opts Options for widget\n */\nclass AdvancedSearch extends Charcoal.Admin.Widget {\n\n    constructor(opts) {\n        if (!opts.data.properties_options) {\n            opts.data.properties_options = {};\n        }\n        super(opts);\n        Charcoal.Admin.Widget.call(this, opts);\n    }\n\n    init() {\n        this.$form             = this.element();\n        this.$applyBtn         = $('.js-filter-apply', this.$form);\n        this.$exportBtn        = $('.js-filter-export', this.$form);\n        this.$sortBtn          = $('.sort-dropdown', this.$form);\n        this.$activeFilterList = $('.active-filters', this.$form);\n        this.totalRows         = 0;\n        this.isReloading       = false;\n        this.clearOnEmpty      = false;\n\n        // This is used to display the filters\n        this.filterRecap = new AdvancedSearchFilterRecap(this.$form, this.$activeFilterList, this);\n\n        this.$form.on('submit.charcoal.search.filter', function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.submit();\n        }.bind(this));\n\n        const that = this;\n        this.$activeFilterList.on('click', '.js-remove-filter', function (e) {\n            that.filterRecap.removeActiveFilter(e.target);\n\n            // Clear everything if there are no more active filters.\n            if (that.countChanges() === 0 && that.clearOnEmpty) { that.clear(); }\n        });\n\n        this.$form.on('click.charcoal.search.filter', '.js-filter-reset', this.clear.bind(this));\n\n        // Handle change sorting\n        this.$form.on(\n            'click.charcoal.search.filter',\n            '.sort-dropdown + .dropdown-menu>.dropdown-item',\n            this.sort.bind(this)\n        );\n\n        $('.c-filters-tab').on('click', function () {\n            const tab_key = $(this).attr('data-tab');\n\n            // Activate tab button\n            $('.c-filters-tab').removeClass('active');\n            $('.c-filters-tab button i').addClass('fa-angle-down');\n            // Flip arrow\n            $(this).addClass('active');\n            $('button i', this).removeClass('fa-angle-down').addClass('fa-angle-up');\n\n            // Active tab field group\n            $('.c-filter-group.active').removeClass('active');\n            $('.c-filter-group[data-tab=\"' + tab_key + '\"]').addClass('active');\n        });\n\n        if ($('.c-filters-tab.active').length === 0) {\n            $('.c-filters-tab').first().click();\n        }\n\n        const widget = this;\n\n        $(this.$exportBtn).on('click', function () {\n            widget.export();\n            return false;\n        });\n\n        this.$form.on('change', 'input, select', (e) => widget.onFieldChange(e));\n        $('.datetimepickerinput', this.$form).on('change.datetimepicker', (e) => widget.onFieldChange(e));\n        $($('input:not([type=hidden]), select:not([type=hidden])', this.$form)[0]).trigger('change');\n\n        if (this.countActiveFilters() > 0) {\n            this.clearOnEmpty = true;\n\n            const manager = Charcoal.Admin.manager();\n            manager.ready(() => {\n                const widgets = manager.components.widgets;\n\n                if (widgets.length > 0) {\n                    widgets.forEach(function (widget) {\n                        if (!widget || typeof widget.set_filters !== 'function') {\n                            return this;\n                        }\n\n                        const total_rows = widget.opts('data').total_rows ?? null;\n\n                        if (total_rows !== null) {\n                            this.setTotalRows(total_rows);\n                        }\n                    }.bind(this));\n                }\n            });\n        }\n    }\n\n    onFieldChange(e) {\n        // Add item to active-filters list\n        const widget = this;\n        const targetFilter = e.target;\n        let formField    = $(targetFilter).attr('id');\n        let filterVal    = $(targetFilter).val();\n        let filterName    = $(targetFilter).attr('name');\n\n        if (!filterName && typeof e.date === 'undefined') {\n            // Date range filters don't have filtername and are yet valid filters\n            // All other shall fail\n            return ;\n        }\n\n        // Checkboxes are different!\n        if (e.target.type === 'checkbox') {\n            filterVal = $(targetFilter).is(':checked') ? 'checked' : '';\n        }\n\n        // Date\n        if (typeof e.date !== 'undefined') {\n            const filterInput     = $('input', targetFilter).first();\n            const filterInputName = filterInput.attr('name');\n            formField             = filterInput.attr('id');\n\n            if (filterInputName.endsWith(\"[to]\") || filterInputName.endsWith(\"[from]\")) {\n                // Is a date range\n                const primaryName = filterInputName.replace('[from]', '').replace('[to]', '');\n                const dates = [\n                    $('input[name=\"' + primaryName + '[from]\"]').val() || null,\n                    $('input[name=\"' + primaryName + '[to]\"]').val()   || null\n                ].filter(function (element) {\n                    return element !== null;\n                });\n\n                filterVal = dates.join(' - ');\n            } else {\n                filterVal = filterInput.val();\n            }\n        }\n\n        if (!filterVal.length) {\n            widget.removeActiveFilter(formField);\n            if (!$(targetFilter).is('input, select')) {\n                $(targetFilter).find('.changed').removeClass('changed');\n            } else {\n                $(targetFilter).removeClass('changed');\n            }\n        } else {\n            // Check for inputs with values\n            if (!$(targetFilter).is('input, select')) {\n                $(targetFilter).find('input, select').addClass('changed');\n            } else {\n                $(targetFilter).addClass('changed');\n            }\n        }\n\n        widget.filterRecap.refresh();\n        // Clear everything if there are no more active filters.\n        if (widget.countChanges() === 0 && widget.clearOnEmpty) { widget.clear(); }\n    }\n\n    /**\n     * Count total active filters.\n     *\n     * @returns {int} Total active filters.\n     */\n    countActiveFilters() {\n        return $('li', this.$activeFilterList).length;\n    }\n\n    /**\n     * Clean filter ID of 'from'/'to'.\n     *\n     * @param {string} filterId\n     * @returns\n     */\n    cleanFilterId(filterId) {\n        let filterIdClean = filterId;\n\n        if (filterId.includes('from_input_') || filterId.includes('to_input_')) {\n            filterIdClean = filterIdClean.replace('from_', '').replace('to_', '');\n        }\n\n        return filterIdClean;\n    }\n\n    /**\n     * Remove item from active filter list.\n     *\n     * @param {string} target Remove Event or target string.\n     */\n    removeActiveFilter(target) {\n        if (typeof target === 'undefined') {\n            this.filterRecap.removeActiveFilter();\n            return;\n        }\n\n        target = this.cleanFilterId(target);\n        target = $('li[data-key=\"' + target + '\"]', this.$activeFilterList);\n        this.filterRecap.removeActiveFilter(target.get(0));\n    }\n\n    setTotalRows(totalRows) {\n        this.totalRows = totalRows;\n        const totalRowsEl = $('.filters-total-rows').first();\n        totalRowsEl.find('.row-count').text(this.totalRows);\n        totalRowsEl.attr('data-count', this.totalRows);\n    }\n\n    /**\n     * Count all changed filters.\n     *\n     * @returns {int} Change count.\n     */\n    countChanges() {\n        const changeCount = $('input.changed, select.changed', this.$form).length;\n        const hasChanges = changeCount > 0;\n        const changeCountString = hasChanges ? '(' + changeCount + ')' : '';\n\n        // Disable buttons when there are no changes\n        $('.js-filter-apply, .js-filter-reset, .js-filter-export', this.$form).prop('disabled', !hasChanges);\n\n        // Set the label to singular/plural format\n        $('.btn-label span.active', this.$applyBtn).removeClass('active');\n        $('.btn-label span.active', this.$exportBtn).removeClass('active');\n        $((changeCount === 1 ? '.btn-label-singular' : '.btn-label-plural'), this.$applyBtn).addClass('active');\n\n        // Append change count to apply button\n        $('.filter-apply-count', this.$applyBtn).text(changeCountString);\n\n        // Add tab filter count to tab label\n        $('.c-filter-group').each(function () {\n            const tabChangeCount = $('input.changed, select.changed', this).length;\n            const tabFilterCountEl = $('.c-filters-tab[data-tab=\"' + $(this).data('tab') + '\"] .tab-filter-count');\n\n            tabFilterCountEl.attr('data-count', tabChangeCount);\n            tabFilterCountEl.find('.count').text(tabChangeCount);\n        });\n\n        return changeCount;\n    }\n\n    /**\n     * Resets the filter widgets.\n     *\n     * @return this\n     */\n    clear() {\n        // Reset form\n        this.removeActiveFilter();\n\n        // Clear selects\n        this.$form.find('select').each((index, item) => {\n            $(item).val('');\n            $(item).selectpicker('deselectAll');\n        });\n\n        // Clear date pickers\n        $('.datetimepickerinput').each(function() {\n            if ($('.datetimepicker-input', this).val().length) {\n                $(this).datetimepicker('clear');\n            }\n        });\n        // Set changed inputs to unchanged state\n        $('.changed', this.$form).removeClass('changed');\n        // Unrequire fields\n        $('input, select', this.$form).prop('required', false);\n\n        this.countChanges();\n\n        // Clear active filter list\n        $('li', this.$activeFilterList).remove();\n        // Reset sort dropdown\n        $(this.$sortBtn).removeClass('selected');\n\n        this.submit();\n        return this;\n    }\n\n    /**\n     * Resets a filter.\n     *\n     * @param {string} filterId Filter ID.\n     * @return this\n     */\n    clearFilter(listItem) {\n        if (!$(listItem).length) {\n            return;\n        }\n\n        const filterId = $(listItem).data('key');\n        const listItemType = $(listItem).data('type');\n        let filterInput, filterType;\n\n        if (listItemType.includes('date')) {\n            // Handle date pickers\n            if (listItemType === 'date-range') {\n                // Date Range\n                filterType = 'date-range';\n                filterInput = $('#from_' + filterId, this.$form);\n            } else {\n                // Single Date\n                filterType = 'date';\n                filterInput = $('#' + filterId, this.$form);\n            }\n        } else {\n            // Handle all inputs\n            filterInput = $('#' + filterId, this.$form);\n            filterType = filterInput.length ? filterInput[0].type : 'unknown';\n        }\n\n        // Reset respective input\n        switch (filterType) {\n            case 'checkbox':\n                filterInput.prop('checked', false);\n                break;\n\n            case 'select-one':\n            case 'select-multiple':\n                $(filterInput).val('');\n                $(filterInput).selectpicker('refresh');\n                break;\n\n            case 'date-range':\n                filterInput.closest('fieldset').find('.datetimepickerinput').datetimepicker('clear');\n                filterInput.closest('fieldset').find('.changed').removeClass('changed');\n                break;\n\n            default:\n                filterInput.val('');\n                break;\n        }\n\n        $(filterInput).removeClass('changed');\n\n        return this;\n    }\n\n    /**\n     * Change the widget sorting order.\n     *\n     * @param {object} e Event.\n     * @return this\n     */\n    sort(e) {\n        const optionEl = $(e.target).closest('.dropdown-item');\n        const label = $('.btn-label', optionEl).text();\n\n        if ($(optionEl).hasClass('default')) {\n            // Reset button to default sort\n            $(this.$sortBtn).removeClass('selected');\n        } else {\n            // Perform sort\n            $(this.$sortBtn).addClass('selected').data({\n                property: optionEl.data('property'),\n                direction: optionEl.data('direction')\n            });\n            $('.sort-option', this.$sortBtn).find('.sort-option-value').text(label);\n        }\n\n        this.submit();\n\n        return this;\n    }\n\n    /**\n     * Filter object definition.\n     *\n     * @param {object} name Input dom object.\n     * @param {string} name Filter name.\n     * @param {string} value Filter value.\n     */\n    filterObj(input, name, value) {\n        const formField    = $(input).closest('.form-field');\n        const dataOperator = formField.data('operator') || '';\n\n        this.name     = name;\n        this.value    = value;\n        this.operator = '=';\n        this.type     = input.type;\n\n        this.parseInvalidBetween = function (name, value) {\n            this.type     = 'date';\n            this.value    = value;\n            this.operator = name.endsWith(\"[from]\") ? '>' : '<';\n        };\n\n        if (dataOperator.length) {\n            this.operator = dataOperator;\n        }\n\n        // text field\n        if (this.type === 'text' && this.operator === 'LIKE') {\n            this.value = '%' + this.value + '%';\n        }\n\n        // switch checkbox\n        if (this.type === 'checkbox') {\n            this.value = input.checked;\n        }\n\n        if (this.type === 'select-multiple') {\n            this.value = $(input).val();\n            if (this.operator !== 'FIND_IN_SET') {\n                this.operator = \"IN\";\n            }\n        }\n\n        if (name.endsWith(\"[from]\") || name.endsWith(\"[to]\")) {\n            this.type = 'daterange';\n            this.operator = 'BETWEEN';\n            this.matching = name.endsWith('[from]') ? name.replace('[from]', '[to]') : name.replace('[to]', '[from]');\n\n            const matching_value = $('input[name=\"' + this.matching + '\"]').val();\n\n            if (!this.value.length || !matching_value.length) {\n                if (!this.value.length) {\n                    this.parseInvalidBetween(this.matching, matching_value);\n                } else {\n                    this.parseInvalidBetween(this.name, this.value);\n                }\n            }\n        }\n    }\n\n    /**\n     * Submit the filters to all widgets.\n     *\n     * @return this\n     */\n    submit() {\n        let data, fields, filters = [], manager, widgets, request;\n        const that = this;\n\n        manager = Charcoal.Admin.manager();\n        widgets = manager.components.widgets;\n\n        if (widgets.length > 0) {\n            data = this.$form.serializeArray();\n            fields = this.$form.find(':input.changed');\n\n            $.each(fields, function (i, field) {\n                if (!!field.value) {\n                    filters.push(new that.filterObj(field, field.name, field.value));\n                }\n            });\n\n            this.clearOnEmpty = filters.length > 0;\n\n            request = this.prepare_request(filters);\n\n            widgets.forEach(function (widget) {\n                this.dispatch(request, widget);\n            }.bind(this));\n        }\n\n        return this;\n    }\n\n    export() {\n        let data, fields, filters = [], manager, widgets, request;\n        const that = this;\n\n        manager = Charcoal.Admin.manager();\n        widgets = manager.components.widgets;\n\n        if (widgets.length > 0) {\n            data = this.$form.serializeArray();\n            fields = this.$form.find(':input.changed');\n\n            $.each(fields, function (i, field) {\n                if (!!field.value) {\n                    filters.push(new that.filterObj(field, field.name, field.value));\n                }\n            });\n\n            request = this.prepare_request(filters);\n            widgets.forEach(function (widget) {\n                if (typeof widget.set_filters !== 'function') {\n                    return;\n                }\n\n                data = {\n                    widget_type: widget.widget_type(),\n                    widget_options: widget.widget_options(),\n                    with_data: true\n                };\n\n                const filters = [];\n                if (request.filters) {\n                    filters.push(request.filters);\n                }\n\n                const orders = [];\n                if (request.orders) {\n                    orders.push(request.orders);\n                }\n\n                data.widget_options.collection_config.filters = filters || {};\n                data.widget_options.collection_config.orders = orders || {};\n\n            }.bind(this));\n\n            const url = Charcoal.Admin.admin_url() + 'advanced-search/export' + window.location.search;\n\n            $(this.$form).addClass('loading');\n\n            this.reloadXHR = $.ajax({\n                type: 'POST',\n                url: url,\n                data: JSON.stringify(data),\n                dataType: 'json',\n                contentType: 'application/json',\n            });\n\n            let success, failure, complete;\n\n            success = function (response) {\n                if (typeof response.widget_id !== 'string') {\n                    response.feedbacks.push({\n                        level: 'error',\n                        message: widgetL10n.loadingFailed\n                    });\n\n                    failure.call(this, response);\n                    return;\n                }\n\n                const wid = response.widget_id;\n                that.set_id(wid);\n                that.add_opts('id', wid);\n                that.add_opts('widget_id', wid);\n\n                that.widget_id = wid;\n                if (typeof response.file !== 'string') {\n                    response.feedbacks.push({\n                        level: 'error',\n                        message: widgetL10n.loadingFailed\n                    });\n                    failure.call(this, response);\n                    return;\n                }\n\n                window.location.href = Charcoal.Admin.admin_url() + 'advanced-search/download?filename=' + response.file;\n            };\n\n            failure = function (response) {\n                if (response.feedbacks.length) {\n                    Charcoal.Admin.feedback(response.feedbacks);\n                } else {\n                    Charcoal.Admin.feedback([{\n                        level: 'error',\n                        message: widgetL10n.loadingFailed\n                    }]);\n                }\n            };\n\n            complete = function () {\n                if (!that.suppress_feedback()) {\n                    Charcoal.Admin.feedback().dispatch();\n                }\n                $(that.$form).removeClass('loading');\n            };\n\n            Charcoal.Admin.resolveSimpleJsonXhr(\n                this.reloadXHR,\n                success,\n                failure,\n                complete\n            );\n\n        }\n\n        return this;\n    }\n\n    /**\n     * Prepares a search request from a query.\n     *\n     * @param  {array} query - The filters.\n     * @return {object|null} A search request object or NULL.\n     */\n    prepare_request(p_filters) {\n        let request            = null, filters = [], opts;\n        const data             = this.opts('data');\n        const orderProperty    = $(this.$sortBtn).data('property');\n        const collection_table = this.opts('collection_table');\n\n        p_filters.forEach(function (filter_obj) {\n            const propName     = filter_obj.name.replace(/(\\[.*)/gi, '');\n            let filter_table   = null;\n            let value_override = [];\n\n            opts = data.properties_options[propName] || {};\n\n            if (typeof opts.table !== 'undefined' && opts.table !== collection_table) {\n                filter_table = opts.table || null;\n            }\n\n            if (typeof filter_obj !== 'undefined') {\n                if (filter_obj.type === 'daterange') {\n                    // Is daterange input\n                    if (filter_obj.operator === 'BETWEEN' && filter_obj.name.endsWith('[to]')) {\n                        return false;\n                    }\n\n                    const matching_value = $('input[name=\"' + filter_obj.matching + '\"]').val();\n\n                    if (filter_obj.name.endsWith('[from]')) {\n                        value_override = [filter_obj.value, matching_value];\n                    } else {\n                        value_override = [matching_value, filter_obj.value];\n                    }\n                }\n            }\n\n            filters.push({\n                conjunction: opts.conjunction || 'AND',\n                table: filter_table,\n                property: propName,\n                value: value_override.length ? value_override : filter_obj.value,\n                operator: filter_obj.operator\n            });\n        });\n\n        request = {\n            filters: null,\n            orders: null,\n        };\n\n        if (filters.length) {\n            request.filters = {\n                filters: filters,\n                name: 'advanced-search',\n                table: collection_table\n            };\n        }\n\n        if ($(this.$sortBtn).hasClass('selected') && orderProperty) {\n            request.orders = {\n                direction: $(this.$sortBtn).data('direction'),\n                mode: $(this.$sortBtn).data('direction'),\n                property: orderProperty\n            };\n        }\n\n        return request;\n    }\n\n    /**\n     * Dispatches the event to all widgets that can listen to it.\n     *\n     * @param  {object} request - The search request.\n     * @param  {object} widget  - The widget to search on.\n     * @return this\n     */\n    dispatch(request, widget) {\n        if (this.isReloading || !widget || typeof widget.set_filters !== 'function') {\n            return this;\n        }\n\n        if (typeof widget.pagination !== 'undefined') {\n            widget.pagination.page = 1;\n        }\n\n        // Initialize filters array\n        const filters = [];\n\n        // Add isAdvancedSearch dummy filter.\n        // This can be used to detect if a table widget was loaded using Advanced Search\n        filters.push({\n            conjunction: 'AND',\n            name: 'isAdvancedSearch',\n            condition: '(1 = 1)',\n        });\n\n        if (request.filters) {\n            filters.push(request.filters);\n        }\n\n        widget.set_filters(filters);\n\n        const orders = [];\n        if (request.orders) {\n            orders.push(request.orders);\n        }\n\n        $(this.$form).addClass('loading');\n        this.isReloading = true;\n\n        widget.set_orders(orders);\n\n        // Support site search\n        const site_search = this.opts('site_search');\n\n        if (site_search.length > 0) {\n            var search_widget = Charcoal.Admin.manager().get_widget(site_search);\n\n            if (typeof widget.set_search_query === 'function') {\n                search_widget.set_search_query(search_widget.$input.val());\n                widget.set_search_query(search_widget.search_query());\n            }\n\n            if (typeof widget.set_filter === 'function') {\n                widget.set_filter('search', search_widget.search_filters());\n            }\n        }\n\n        // Reload the widget\n        widget.reload(function (response) {\n            if (response) {\n                this.setTotalRows(response.widget_data.total_rows);\n            }\n            $(this.$form).removeClass('loading');\n            this.isReloading = false;\n        }.bind(this), true);\n\n        return this;\n    }\n}\n\nexport default AdvancedSearch;\n","/* global Charcoal */\nimport AdvancedSearch from \"./advanced-search\";\n\n;(function () {\n    Charcoal.Admin.Widget_Advanced_Search      = AdvancedSearch;\n    Charcoal.Admin.Widget_Advanced_Search_Tabs = AdvancedSearch;\n}(jQuery));\n"],"mappings":"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","ignoreList":[]}