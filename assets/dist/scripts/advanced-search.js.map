{"version":3,"file":"advanced-search.js","sources":["../../src/scripts/filter-recap.js","../../src/scripts/advanced-search.js","../../src/scripts/index.js"],"sourcesContent":["class AdvancedSearchFilterRecap {\n    constructor($form, $activeFilterList, parent) {\n        this.$form = $form;\n        this.$activeFilterList = $activeFilterList;\n        this.filterObject = undefined;\n        this.parent = parent;\n    }\n\n    /**\n     * Event\n     * Call when anything changes in the filter area\n     */\n    refresh() {\n        this.buildFilterObjectFromInputs();\n        this.displayFilters();\n    }\n\n    /**\n     * Fetch all inputs and build a json usable to display filters\n     *\n     * @param $container\n     */\n    buildFilterObjectFromInputs() {\n        const output = [];\n        const that = this;\n        const formFieldIds = [];\n\n        $('input, select', this.$form).each(function (i, current) {\n            // Skip unfilled filters\n            // @todo Add more context than only !current.value\n            if (!current.value) {\n                return true;\n            }\n\n            if (current.type === 'checkbox' && !$(current).is(':checked')) {\n                return true;\n            }\n\n            const value = that.extractLabelAndValueFromInput(current);\n\n            if (!value) {\n                return;\n            }\n\n            if (!formFieldIds.includes(value.id)) {\n                formFieldIds.push(value.id);\n                // Populate output\n                output.push(value);\n            }\n        });\n\n        this.filterObject = output;\n    }\n\n    extractLabelAndValueFromInput(domElement) {\n        let tmp = null;\n\n        // Base values\n        const $domElement = $(domElement);\n        let formField = $domElement.attr('id');\n        let filterVal = $domElement.val();\n        let filterType = 'input';\n\n        // Filter name from label\n        const filterWrapper = $domElement.closest('fieldset');\n        const filterName = $('label', filterWrapper).first().text();\n\n        const inputName = $domElement.attr('name');\n\n        if (typeof inputName === 'undefined') {\n            return false;\n        }\n\n        // Datetime range\n        if (inputName.endsWith(\"[to]\") || inputName.endsWith(\"[from]\")) {\n            // The formField id will be used to prevent having twice the safe filter displayed in the list\n            // Since the from and to inputs have the same ID except for that prefix\n            formField = formField.replace('from_', '').replace('to_', '');\n            tmp = this.extractFromDateRange(domElement);\n        }\n\n        // Select\n        if (domElement.tagName === 'SELECT') {\n            tmp = this.extractFromSelect(domElement);\n        }\n\n        // Checkbox\n        if (domElement.type === 'checkbox') {\n            tmp = this.extractFromCheckbox(domElement);\n        }\n\n        // Override values\n        if (tmp !== null && tmp) {\n            filterType = tmp.type;\n            filterVal = tmp.val;\n        }\n\n        return {\n            id: formField,\n            type: filterType,\n            val: filterVal,\n            name: filterName\n        };\n    }\n\n    /**\n     *\n     * @param $input\n     * @returns {{val: string, type: string}}\n     */\n    extractFromDateRange(domElement) {\n        const filterInput = $(domElement);\n        const filterInputName = filterInput.attr('name');\n\n        // Is a date range\n        const filterType = 'date-range';\n        const primaryName = filterInputName.replace('[from]', '').replace('[to]', '');\n        const dates = [\n            $('input[name=\"' + primaryName + '[from]\"]').val() || null,\n            $('input[name=\"' + primaryName + '[to]\"]').val() || null\n        ].filter(function (element) {\n            return element !== null;\n        });\n\n        const filterVal = dates.join(' - ');\n\n        return {\n            type: filterType,\n            val: filterVal\n        };\n    }\n\n    extractFromSelect(domElement) {\n        const filterType = 'select';\n        const filterVal = Array.from(domElement.selectedOptions).map(function (option) {\n            return option.value ? option.innerHTML : null;\n        })\n            .filter(function (element) {\n                return element !== null;\n            })\n            .join(', ');\n\n        return {\n            type: filterType,\n            val: filterVal\n        };\n    }\n\n    /**\n     * Weird, it should definitly be Yes at all time at this point\n     *\n     * @param domElement\n     * @returns {{val: (string), type: string}}\n     */\n    extractFromCheckbox(domElement) {\n        const filterVal = $(domElement).is(':checked') ? ($('html').attr('lang') === 'fr' ? 'Oui' : 'Yes') : '';\n\n        return {\n            type: 'checkbox',\n            val: filterVal\n        };\n    }\n\n    /**\n     * Display filters labels from the json\n     */\n    displayFilters() {\n        if (this.filterObject === undefined) {\n            return;\n        }\n        this.$activeFilterList.empty();\n\n        for (const i in this.filterObject) {\n            const currentFilter = this.filterObject[i];\n            this.addActiveFilter(currentFilter);\n        }\n    }\n\n    /**\n     * Add Active Filter.\n     *\n     * @param {object} opts\n     * @param {string} opts.id\n     * @param {string} opts.type\n     * @param {string} opts.label\n     * @param {string} opts.val\n     */\n    addActiveFilter(opts) {\n        const id = opts.id;\n        const type = opts.type;\n        const label = opts.name;\n        const value = opts.val;\n\n        const listItem = $('<li></li>')\n            .append($('<span></span>').addClass('label').text(label).attr('title', label))\n            .append($('<span></span>').addClass('value').text(value).attr('title', value))\n            .append($('<div></div>').addClass('remove fa fa-times js-remove-filter'))\n            .attr('data-key', id)\n            .attr('data-type', type);\n        $(this.$activeFilterList).append(listItem);\n    }\n\n    /**\n     * Remove item from active filter list.\n     *\n     * @param {Element|string} domElement Remove Event or target string.\n     */\n    removeActiveFilter(domElement) {\n        var filter_recap = this;\n\n        // Remove all filters if domElement is undefined.\n        if (typeof domElement === 'undefined') {\n            $('li', filter_recap.$activeFilterList).each(function() {\n                filter_recap.removeListItem(this);\n            });\n            return;\n        }\n\n        // Remove domElement from the active filter list.\n        filter_recap.removeListItem(domElement);\n    }\n\n    removeListItem(domElement) {\n        // Remove domElement from the active filter list.\n        const listItem = $(domElement).closest('li');\n\n        if (listItem.length) {\n            this.parent.clearFilter(listItem);\n            listItem.remove();\n        }\n    }\n}\n\nexport default AdvancedSearchFilterRecap;\n","/* global Charcoal */\nimport AdvancedSearchFilterRecap from \"./filter-recap\";\n\nconst widgetL10n = window.widgetL10n || {};\nconst $ = jQuery;\n\n/**\n * Advanced search widget used for filtering a list\n * `charcoal/advanced-search/widget/advanced-search`\n *\n * Require:\n * - jQuery\n *\n * @param  {Object}  opts Options for widget\n */\nclass AdvancedSearch extends Charcoal.Admin.Widget {\n\n    constructor(opts) {\n        if (!opts.data.properties_options) {\n            opts.data.properties_options = {};\n        }\n        super(opts);\n        Charcoal.Admin.Widget.call(this, opts);\n    }\n\n    init() {\n        this.$form             = this.element();\n        this.$applyBtn         = $('.js-filter-apply', this.$form);\n        this.$exportBtn        = $('.js-filter-export', this.$form);\n        this.$sortBtn          = $('.sort-dropdown', this.$form);\n        this.$activeFilterList = $('.active-filters', this.$form);\n        this.totalRows         = 0;\n        this.isReloading       = false;\n        this.clearOnEmpty      = false;\n\n        // This is used to display the filters\n        this.filterRecap = new AdvancedSearchFilterRecap(this.$form, this.$activeFilterList, this);\n\n        this.$form.on('submit.charcoal.search.filter', function (e) {\n            e.preventDefault();\n            e.stopPropagation();\n            this.submit();\n        }.bind(this));\n\n        const that = this;\n        this.$activeFilterList.on('click', '.js-remove-filter', function (e) {\n            that.filterRecap.removeActiveFilter(e.target);\n\n            // Clear everything if there are no more active filters.\n            if (that.countChanges() === 0 && that.clearOnEmpty) { that.clear(); }\n        });\n\n        this.$form.on('click.charcoal.search.filter', '.js-filter-reset', this.clear.bind(this));\n\n        // Handle change sorting\n        this.$form.on(\n            'click.charcoal.search.filter',\n            '.sort-dropdown + .dropdown-menu>.dropdown-item',\n            this.sort.bind(this)\n        );\n\n        $('.c-filters-tab').on('click', function () {\n            const tab_key = $(this).attr('data-tab');\n\n            // Activate tab button\n            $('.c-filters-tab').removeClass('active');\n            $('.c-filters-tab button i').addClass('fa-angle-down');\n            // Flip arrow\n            $(this).addClass('active');\n            $('button i', this).removeClass('fa-angle-down').addClass('fa-angle-up');\n\n            // Active tab field group\n            $('.c-filter-group.active').removeClass('active');\n            $('.c-filter-group[data-tab=\"' + tab_key + '\"]').addClass('active');\n        });\n\n        if ($('.c-filters-tab.active').length === 0) {\n            $('.c-filters-tab').first().click();\n        }\n\n        const widget = this;\n\n        $(this.$exportBtn).on('click', function () {\n            widget.export();\n            return false;\n        });\n\n        this.$form.on('change', 'input, select', (e) => widget.onFieldChange(e));\n        $('.datetimepickerinput', this.$form).on('change.datetimepicker', (e) => widget.onFieldChange(e));\n        $($('input:not([type=hidden]), select:not([type=hidden])', this.$form)[0]).trigger('change');\n\n        if (this.countActiveFilters() > 0) {\n            this.clearOnEmpty = true;\n\n            const manager = Charcoal.Admin.manager();\n            manager.ready(() => {\n                const widgets = manager.components.widgets;\n\n                if (widgets.length > 0) {\n                    widgets.forEach(function (widget) {\n                        if (!widget || typeof widget.set_filters !== 'function') {\n                            return this;\n                        }\n\n                        const total_rows = widget.opts('data').total_rows ?? null;\n\n                        if (total_rows !== null) {\n                            this.setTotalRows(total_rows);\n                        }\n                    }.bind(this));\n                }\n            });\n        }\n    }\n\n    onFieldChange(e) {\n        // Add item to active-filters list\n        const widget = this;\n        const targetFilter = e.target;\n        let formField    = $(targetFilter).attr('id');\n        let filterVal    = $(targetFilter).val();\n        let filterName    = $(targetFilter).attr('name');\n\n        if (!filterName && typeof e.date === 'undefined') {\n            // Date range filters don't have filtername and are yet valid filters\n            // All other shall fail\n            return ;\n        }\n\n        // Checkboxes are different!\n        if (e.target.type === 'checkbox') {\n            filterVal = $(targetFilter).is(':checked') ? 'checked' : '';\n        }\n\n        // Date\n        if (typeof e.date !== 'undefined') {\n            const filterInput     = $('input', targetFilter).first();\n            const filterInputName = filterInput.attr('name');\n            formField             = filterInput.attr('id');\n\n            if (filterInputName.endsWith(\"[to]\") || filterInputName.endsWith(\"[from]\")) {\n                // Is a date range\n                const primaryName = filterInputName.replace('[from]', '').replace('[to]', '');\n                const dates = [\n                    $('input[name=\"' + primaryName + '[from]\"]').val() || null,\n                    $('input[name=\"' + primaryName + '[to]\"]').val()   || null\n                ].filter(function (element) {\n                    return element !== null;\n                });\n\n                filterVal = dates.join(' - ');\n            } else {\n                filterVal = filterInput.val();\n            }\n        }\n\n        if (!filterVal.length) {\n            widget.removeActiveFilter(formField);\n            if (!$(targetFilter).is('input, select')) {\n                $(targetFilter).find('.changed').removeClass('changed');\n            } else {\n                $(targetFilter).removeClass('changed');\n            }\n        } else {\n            // Check for inputs with values\n            if (!$(targetFilter).is('input, select')) {\n                $(targetFilter).find('input, select').addClass('changed');\n            } else {\n                $(targetFilter).addClass('changed');\n            }\n        }\n\n        widget.filterRecap.refresh();\n        // Clear everything if there are no more active filters.\n        if (widget.countChanges() === 0 && widget.clearOnEmpty) { widget.clear(); }\n    }\n\n    /**\n     * Count total active filters.\n     *\n     * @returns {int} Total active filters.\n     */\n    countActiveFilters() {\n        return $('li', this.$activeFilterList).length;\n    }\n\n    /**\n     * Clean filter ID of 'from'/'to'.\n     *\n     * @param {string} filterId\n     * @returns\n     */\n    cleanFilterId(filterId) {\n        let filterIdClean = filterId;\n\n        if (filterId.includes('from_input_') || filterId.includes('to_input_')) {\n            filterIdClean = filterIdClean.replace('from_', '').replace('to_', '');\n        }\n\n        return filterIdClean;\n    }\n\n    /**\n     * Remove item from active filter list.\n     *\n     * @param {string} target Remove Event or target string.\n     */\n    removeActiveFilter(target) {\n        if (typeof target === 'undefined') {\n            this.filterRecap.removeActiveFilter();\n            return;\n        }\n\n        target = this.cleanFilterId(target);\n        target = $('li[data-key=\"' + target + '\"]', this.$activeFilterList);\n        this.filterRecap.removeActiveFilter(target.get(0));\n    }\n\n    setTotalRows(totalRows) {\n        this.totalRows = totalRows;\n        const totalRowsEl = $('.filters-total-rows').first();\n        totalRowsEl.find('.row-count').text(this.totalRows);\n        totalRowsEl.attr('data-count', this.totalRows);\n    }\n\n    /**\n     * Count all changed filters.\n     *\n     * @returns {int} Change count.\n     */\n    countChanges() {\n        const changeCount = $('input.changed, select.changed', this.$form).length;\n        const hasChanges = changeCount > 0;\n        const changeCountString = hasChanges ? '(' + changeCount + ')' : '';\n\n        // Disable buttons when there are no changes\n        $('.js-filter-apply, .js-filter-reset, .js-filter-export', this.$form).prop('disabled', !hasChanges);\n\n        // Set the label to singular/plural format\n        $('.btn-label span.active', this.$applyBtn).removeClass('active');\n        $('.btn-label span.active', this.$exportBtn).removeClass('active');\n        $((changeCount === 1 ? '.btn-label-singular' : '.btn-label-plural'), this.$applyBtn).addClass('active');\n\n        // Append change count to apply button\n        $('.filter-apply-count', this.$applyBtn).text(changeCountString);\n\n        // Add tab filter count to tab label\n        $('.c-filter-group').each(function () {\n            const tabChangeCount = $('input.changed, select.changed', this).length;\n            const tabFilterCountEl = $('.c-filters-tab[data-tab=\"' + $(this).data('tab') + '\"] .tab-filter-count');\n\n            tabFilterCountEl.attr('data-count', tabChangeCount);\n            tabFilterCountEl.find('.count').text(tabChangeCount);\n        });\n\n        return changeCount;\n    }\n\n    /**\n     * Resets the filter widgets.\n     *\n     * @return this\n     */\n    clear() {\n        // Reset form\n        this.removeActiveFilter();\n\n        // Clear selects\n        this.$form.find('select').each((index, item) => {\n            $(item).val('');\n            $(item).selectpicker('deselectAll');\n        });\n\n        // Clear date pickers\n        $('.datetimepickerinput').each(function() {\n            if ($('.datetimepicker-input', this).val().length) {\n                $(this).datetimepicker('clear');\n            }\n        });\n        // Set changed inputs to unchanged state\n        $('.changed', this.$form).removeClass('changed');\n        // Unrequire fields\n        $('input, select', this.$form).prop('required', false);\n\n        this.countChanges();\n\n        // Clear active filter list\n        $('li', this.$activeFilterList).remove();\n        // Reset sort dropdown\n        $(this.$sortBtn).removeClass('selected');\n\n        this.submit();\n        return this;\n    }\n\n    /**\n     * Resets a filter.\n     *\n     * @param {string} filterId Filter ID.\n     * @return this\n     */\n    clearFilter(listItem) {\n        if (!$(listItem).length) {\n            return;\n        }\n\n        const filterId = $(listItem).data('key');\n        const listItemType = $(listItem).data('type');\n        let filterInput, filterType;\n\n        if (listItemType.includes('date')) {\n            // Handle date pickers\n            if (listItemType === 'date-range') {\n                // Date Range\n                filterType = 'date-range';\n                filterInput = $('#from_' + filterId, this.$form);\n            } else {\n                // Single Date\n                filterType = 'date';\n                filterInput = $('#' + filterId, this.$form);\n            }\n        } else {\n            // Handle all inputs\n            filterInput = $('#' + filterId, this.$form);\n            filterType = filterInput.length ? filterInput[0].type : 'unknown';\n        }\n\n        // Reset respective input\n        switch (filterType) {\n            case 'checkbox':\n                filterInput.prop('checked', false);\n                break;\n\n            case 'select-one':\n            case 'select-multiple':\n                $(filterInput).val('');\n                $(filterInput).selectpicker('refresh');\n                break;\n\n            case 'date-range':\n                filterInput.closest('fieldset').find('.datetimepickerinput').datetimepicker('clear');\n                filterInput.closest('fieldset').find('.changed').removeClass('changed');\n                break;\n\n            default:\n                filterInput.val('');\n                break;\n        }\n\n        $(filterInput).removeClass('changed');\n\n        return this;\n    }\n\n    /**\n     * Change the widget sorting order.\n     *\n     * @param {object} e Event.\n     * @return this\n     */\n    sort(e) {\n        const optionEl = $(e.target).closest('.dropdown-item');\n        const label = $('.btn-label', optionEl).text();\n\n        if ($(optionEl).hasClass('default')) {\n            // Reset button to default sort\n            $(this.$sortBtn).removeClass('selected');\n        } else {\n            // Perform sort\n            $(this.$sortBtn).addClass('selected').data({\n                property: optionEl.data('property'),\n                direction: optionEl.data('direction')\n            });\n            $('.sort-option', this.$sortBtn).find('.sort-option-value').text(label);\n        }\n\n        this.submit();\n\n        return this;\n    }\n\n    /**\n     * Filter object definition.\n     *\n     * @param {object} name Input dom object.\n     * @param {string} name Filter name.\n     * @param {string} value Filter value.\n     */\n    filterObj(input, name, value) {\n        const formField    = $(input).closest('.form-field');\n        const dataOperator = formField.data('operator') || '';\n\n        this.name     = name;\n        this.value    = value;\n        this.operator = '=';\n        this.type     = input.type;\n\n        this.parseInvalidBetween = function (name, value) {\n            this.type     = 'date';\n            this.value    = value;\n            this.operator = name.endsWith(\"[from]\") ? '>' : '<';\n        };\n\n        if (dataOperator.length) {\n            this.operator = dataOperator;\n        }\n\n        // text field\n        if (this.type === 'text' && this.operator === 'LIKE') {\n            this.value = '%' + this.value + '%';\n        }\n\n        // switch checkbox\n        if (this.type === 'checkbox') {\n            this.value = input.checked;\n        }\n\n        if (this.type === 'select-multiple') {\n            this.value = $(input).val();\n            if (this.operator !== 'FIND_IN_SET') {\n                this.operator = \"IN\";\n            }\n        }\n\n        if (name.endsWith(\"[from]\") || name.endsWith(\"[to]\")) {\n            this.type = 'daterange';\n            this.operator = 'BETWEEN';\n            this.matching = name.endsWith('[from]') ? name.replace('[from]', '[to]') : name.replace('[to]', '[from]');\n\n            const matching_value = $('input[name=\"' + this.matching + '\"]').val();\n\n            if (!this.value.length || !matching_value.length) {\n                if (!this.value.length) {\n                    this.parseInvalidBetween(this.matching, matching_value);\n                } else {\n                    this.parseInvalidBetween(this.name, this.value);\n                }\n            }\n        }\n    }\n\n    /**\n     * Submit the filters to all widgets.\n     *\n     * @return this\n     */\n    submit() {\n        let data, fields, filters = [], manager, widgets, request;\n        const that = this;\n\n        manager = Charcoal.Admin.manager();\n        widgets = manager.components.widgets;\n\n        if (widgets.length > 0) {\n            data = this.$form.serializeArray();\n            fields = this.$form.find(':input.changed');\n\n            $.each(fields, function (i, field) {\n                if (!!field.value) {\n                    filters.push(new that.filterObj(field, field.name, field.value));\n                }\n            });\n\n            this.clearOnEmpty = filters.length > 0;\n\n            request = this.prepare_request(filters);\n\n            widgets.forEach(function (widget) {\n                this.dispatch(request, widget);\n            }.bind(this));\n        }\n\n        return this;\n    }\n\n    export() {\n        let data, fields, filters = [], manager, widgets, request;\n        const that = this;\n\n        manager = Charcoal.Admin.manager();\n        widgets = manager.components.widgets;\n\n        if (widgets.length > 0) {\n            data = this.$form.serializeArray();\n            fields = this.$form.find(':input.changed');\n\n            $.each(fields, function (i, field) {\n                if (!!field.value) {\n                    filters.push(new that.filterObj(field, field.name, field.value));\n                }\n            });\n\n            request = this.prepare_request(filters);\n            widgets.forEach(function (widget) {\n                if (typeof widget.set_filters !== 'function') {\n                    return;\n                }\n\n                data = {\n                    widget_type: widget.widget_type(),\n                    widget_options: widget.widget_options(),\n                    with_data: true\n                };\n\n                const filters = [];\n                if (request.filters) {\n                    filters.push(request.filters);\n                }\n\n                const orders = [];\n                if (request.orders) {\n                    orders.push(request.orders);\n                }\n\n                data.widget_options.collection_config.filters = filters || {};\n                data.widget_options.collection_config.orders = orders || {};\n\n            }.bind(this));\n\n            const url = Charcoal.Admin.admin_url() + 'advanced-search/export' + window.location.search;\n\n            $(this.$form).addClass('loading');\n\n            this.reloadXHR = $.ajax({\n                type: 'POST',\n                url: url,\n                data: JSON.stringify(data),\n                dataType: 'json',\n                contentType: 'application/json',\n            });\n\n            let success, failure, complete;\n\n            success = function (response) {\n                if (typeof response.widget_id !== 'string') {\n                    response.feedbacks.push({\n                        level: 'error',\n                        message: widgetL10n.loadingFailed\n                    });\n\n                    failure.call(this, response);\n                    return;\n                }\n\n                const wid = response.widget_id;\n                that.set_id(wid);\n                that.add_opts('id', wid);\n                that.add_opts('widget_id', wid);\n\n                that.widget_id = wid;\n                if (typeof response.file !== 'string') {\n                    response.feedbacks.push({\n                        level: 'error',\n                        message: widgetL10n.loadingFailed\n                    });\n                    failure.call(this, response);\n                    return;\n                }\n\n                window.location.href = Charcoal.Admin.admin_url() + 'advanced-search/download?filename=' + response.file;\n            };\n\n            failure = function (response) {\n                if (response.feedbacks.length) {\n                    Charcoal.Admin.feedback(response.feedbacks);\n                } else {\n                    Charcoal.Admin.feedback([{\n                        level: 'error',\n                        message: widgetL10n.loadingFailed\n                    }]);\n                }\n            };\n\n            complete = function () {\n                if (!that.suppress_feedback()) {\n                    Charcoal.Admin.feedback().dispatch();\n                }\n                $(that.$form).removeClass('loading');\n            };\n\n            Charcoal.Admin.resolveSimpleJsonXhr(\n                this.reloadXHR,\n                success,\n                failure,\n                complete\n            );\n\n        }\n\n        return this;\n    }\n\n    /**\n     * Prepares a search request from a query.\n     *\n     * @param  {array} query - The filters.\n     * @return {object|null} A search request object or NULL.\n     */\n    prepare_request(p_filters) {\n        let request            = null, filters = [], opts;\n        const data             = this.opts('data');\n        const orderProperty    = $(this.$sortBtn).data('property');\n        const collection_table = this.opts('collection_table');\n\n        p_filters.forEach(function (filter_obj) {\n            const propName     = filter_obj.name.replace(/(\\[.*)/gi, '');\n            let filter_table   = null;\n            let value_override = [];\n\n            opts = data.properties_options[propName] || {};\n\n            if (typeof opts.table !== 'undefined' && opts.table !== collection_table) {\n                filter_table = opts.table || null;\n            }\n\n            if (typeof filter_obj !== 'undefined') {\n                if (filter_obj.type === 'daterange') {\n                    // Is daterange input\n                    if (filter_obj.operator === 'BETWEEN' && filter_obj.name.endsWith('[to]')) {\n                        return false;\n                    }\n\n                    const matching_value = $('input[name=\"' + filter_obj.matching + '\"]').val();\n\n                    if (filter_obj.name.endsWith('[from]')) {\n                        value_override = [filter_obj.value, matching_value];\n                    } else {\n                        value_override = [matching_value, filter_obj.value];\n                    }\n                }\n            }\n\n            filters.push({\n                conjunction: opts.conjunction || 'AND',\n                table: filter_table,\n                property: propName,\n                value: value_override.length ? value_override : filter_obj.value,\n                operator: filter_obj.operator\n            });\n        });\n\n        request = {\n            filters: null,\n            orders: null,\n        };\n\n        if (filters.length) {\n            request.filters = {\n                filters: filters,\n                name: 'advanced-search',\n                table: collection_table\n            };\n        }\n\n        if ($(this.$sortBtn).hasClass('selected') && orderProperty) {\n            request.orders = {\n                direction: $(this.$sortBtn).data('direction'),\n                mode: $(this.$sortBtn).data('direction'),\n                property: orderProperty\n            };\n        }\n\n        return request;\n    }\n\n    /**\n     * Dispatches the event to all widgets that can listen to it.\n     *\n     * @param  {object} request - The search request.\n     * @param  {object} widget  - The widget to search on.\n     * @return this\n     */\n    dispatch(request, widget) {\n        if (this.isReloading || !widget || typeof widget.set_filters !== 'function') {\n            return this;\n        }\n\n        if (typeof widget.pagination !== 'undefined') {\n            widget.pagination.page = 1;\n        }\n\n        // Initialize filters array\n        const filters = [];\n\n        // Add isAdvancedSearch dummy filter.\n        // This can be used to detect if a table widget was loaded using Advanced Search\n        filters.push({\n            conjunction: 'AND',\n            name: 'isAdvancedSearch',\n            condition: '(1 = 1)',\n        });\n\n        if (request.filters) {\n            filters.push(request.filters);\n        }\n\n        widget.set_filters(filters);\n\n        const orders = [];\n        if (request.orders) {\n            orders.push(request.orders);\n        }\n\n        $(this.$form).addClass('loading');\n        this.isReloading = true;\n\n        widget.set_orders(orders);\n\n        // Support site search\n        const site_search = this.opts('site_search');\n\n        if (site_search.length > 0) {\n            var search_widget = Charcoal.Admin.manager().get_widget(site_search);\n\n            if (typeof widget.set_search_query === 'function') {\n                search_widget.set_search_query(search_widget.$input.val());\n                widget.set_search_query(search_widget.search_query());\n            }\n\n            if (typeof widget.set_filter === 'function') {\n                widget.set_filter('search', search_widget.search_filters());\n            }\n        }\n\n        // Reload the widget\n        widget.reload(function (response) {\n            if (response) {\n                this.setTotalRows(response.widget_data.total_rows);\n            }\n            $(this.$form).removeClass('loading');\n            this.isReloading = false;\n        }.bind(this), true);\n\n        return this;\n    }\n}\n\nexport default AdvancedSearch;\n","/* global Charcoal */\nimport AdvancedSearch from \"./advanced-search\";\n\n;(function () {\n    Charcoal.Admin.Widget_Advanced_Search      = AdvancedSearch;\n    Charcoal.Admin.Widget_Advanced_Search_Tabs = AdvancedSearch;\n}(jQuery));\n"],"names":["$","widget","name","value","filters"],"mappings":"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"}